<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quizzes</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/animations.css') }}" />
  </head>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: #f8f9e9;
      min-height: 100vh;
      display: flex;
    }

    .left {
      width: 20%;
      background: white;
      padding: 20px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      min-height: 100vh;
      border-right: 1px solid #e0e0e0;
    }

    .right {
      height: 100vh;
      width: 80%;
      overflow-y: scroll;
      padding-bottom: 20px;
      overflow-x: hidden;
    }

    .header {
      width: 100%;
      background-color: #fff;
      border-bottom: 1px solid #e0e0e0;
      margin-bottom: 20px;
      padding: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header-title {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .total-quizzes {
      grid-area: 1 / 1 / 2 / 2;
    }
    .active-subjects {
      grid-area: 1 / 2 / 2 / 3;
    }
    .total-students {
      grid-area: 1 / 3 / 2 / 4;
    }
    .avg-score {
      grid-area: 1 / 4 / 2 / 5;
    }

    .total-quizzes,
    .active-subjects,
    .total-students,
    .avg-score {
      background: white;
      margin: 0 10px;
      padding: 20px 25px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border: 1px solid #e6e6e6;
    }
    .stat-left {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .stat-title {
      color: #6b7280;
      font-size: 0.95rem;
    }
    .stat-value {
      font-size: 1.6rem;
      font-weight: 700;
      color: #111827;
    }
    .stat-delta {
      font-size: 0.9rem;
      color: #10b981; /* green for positive */
      font-weight: 600;
    }
    .stat-right {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .stat-icon {
      width: 46px;
      height: 46px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
    }
    .stat-icon.blue {
      background: linear-gradient(180deg, #e8f1ff, #dfeeff);
      color: #1e3a8a;
    }
    .stat-icon.green {
      background: linear-gradient(180deg, #e9f9f0, #dff3e6);
      color: #065f46;
    }
    .stat-icon.purple {
      background: linear-gradient(180deg, #f3e9ff, #eadcff);
      color: #6b21a8;
    }
    .stat-icon.orange {
      background: linear-gradient(180deg, #fff3e6, #ffe7ce);
      color: #b45309;
    }

    .section {
      display: flex;
      gap: 20px;
      padding: 0 20px;
      margin-top: 20px;
      transform: translateX(100%);           /* start off to the right */
      animation: slideIn 600ms ease-out forwards;
    }

    .section-left,
    .section-right {
      border-radius: 12px;
    }

    .section-left {
      width: 70%;
    }

    .section-right {
      width: 30%;
    }

    .available-quizzes {
      width: 100%;
      background: white;
      border-radius: 10px;
      padding: 20px 25px;
      border: 1px solid #e6e6e6;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    .quiz-item {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 12px;
      border-radius: 8px;
      background: #fff;
      border: 1px solid transparent;
    }
    .quiz-item.featured {
      background: linear-gradient(90deg, #ecf9ee, #f6fdf8);
      border: 1px solid #dff3e6;
    }
    /* colored variants for clearer separators (cycle through these) */
    .quiz-color-1 { background: linear-gradient(90deg, #fff7ed, #fff3e0); border: 1px solid #ffe7ce; }
    .quiz-color-2 { background: linear-gradient(90deg, #f3e9ff, #f0e7ff); border: 1px solid #eadcff; }
    .quiz-color-3 { background: linear-gradient(90deg, #e9f9f0, #e6f6ec); border: 1px solid #dff3e6; }
    .quiz-color-4 { background: linear-gradient(90deg, #f6fefc, #f3fcfa); border: 1px solid #e9f9f0; }
    .quiz-color-5 { background: linear-gradient(90deg, #f6f8ff, #f3f6ff); border: 1px solid #e6f0ff; }
    .quiz-icon {
      width: 44px;
      height: 44px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
    }
    .quiz-meta {
      flex: 1;
    }
    .quiz-title {
      font-weight: 700;
      color: #111827;
    }
    .quiz-desc {
      color: #6b7280;
      font-size: 0.95rem;
      margin-top: 6px;
    }
    .badge {
      display: inline-block;
      background: #ecfdf5;
      color: #065f46;
      padding: 4px 8px;
      border-radius: 8px;
      font-size: 0.8rem;
      margin-top: 8px;
    }
    .btn {
      padding: 8px 14px;
      border-radius: 8px;
      border: none;
      font-weight: 700;
      text-decoration: none;
      cursor: pointer;
    }
    .btn.green {
      background: #10b981;
      color: #fff;
    }
    .btn.blue {
      background: #2563eb;
      color: #fff;
    }
    .btn.purple {
      background: linear-gradient(90deg, #7c3aed, #c084fc);
      color: #fff;
    }

    .todays-goal {
      width: 100%;
      background: linear-gradient(180deg, #2b6ef6, #2563eb);
      border-radius: 12px;
      color: #fff;
      padding: 18px;
      margin-bottom: 20px;
      box-shadow: 0 8px 20px rgba(37, 99, 235, 0.12);
    }
    .todays-goal .goal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    .todays-goal .goal-title {
      font-weight: 700;
    }
    .todays-goal .goal-progress-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      color: rgba(255, 255, 255, 0.95);
    }
    .todays-goal .progress-track {
      background: rgba(255, 255, 255, 0.18);
      height: 8px;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 10px;
    }
    .todays-goal .progress-fill {
      height: 100%;
      background: #fff;
      border-radius: 8px;
      width: 66%;
    }
    .todays-goal .goal-note {
      font-size: 0.95rem;
      opacity: 0.95;
    }

    .recent-achievements {
      width: 100%;
      background: white;
      border-radius: 12px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      border: 1px solid #e6e6e6;
      box-shadow: 0 6px 18px rgba(16, 24, 40, 0.03);
    }
    .achievement-item {
      display: flex;
      gap: 12px;
      align-items: center;
    }
    .ach-icon {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
    }
    .ach-icon.gold {
      background: linear-gradient(180deg, #fff7e6, #fff1d6);
      color: #b45309;
    }
    .ach-icon.green {
      background: linear-gradient(180deg, #ecfdf5, #dff7ec);
      color: #059669;
    }
    .ach-text .title {
      font-weight: 700;
      color: #111827;
    }
    .ach-text .subtitle {
      color: #6b7280;
      font-size: 0.9rem;
    }
  </style>
  <body>
    <div class="left">

      {% include 'partials/teacher_sidebar.html' %}

    </div>
    <div class="right">
      <div class="header">
        <div class="header-title">
          <span style="font-size: 1.5rem; font-weight: 700; color: #2d3a2d"
            >Quizzes</span
          >
          <span style="font-size: 1rem; color: grey"
            >Welcome back! Here's what's happening with your quizzes
            today.</span
          >
        </div>
        <div class="header-actions">
          <a href="{{ url_for('main.teacher_create_quiz') }}"
            style="
              padding: 10px 15px;
              border: none;
              border-radius: 6px;
              background-color: #4caf50;
              color: white;
              font-weight: 600;
              text-decoration: none;
            "
          >
            Create Quiz
          </a>
        </div>
      </div>
      <div class="section" style="width: 100%;">
        <div class="available-quizzes" style="width: 100%;">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <input id="quiz-search" type="text" placeholder="Search quizzes..." style="padding: 8px 12px; border-radius: 6px; border: 1px solid #e0e0e0; font-size: 1rem; width: 220px;" />
            <a style="color: #10b981; text-decoration: none; font-weight: 700">View All</a>
          </div>
          {% if quizzes and quizzes|length > 0 %}
            {% for quiz in quizzes %}
              {% set color_idx = (loop.index0 % 5) + 1 %}
              <div class="quiz-item quiz-color-{{ color_idx }}" data-title="{{ quiz.title|e }}" data-subject="{{ quiz.subject.name if quiz.subject else ''|e }}" style="border-radius: 8px; padding: 12px; display: flex; align-items: center; gap: 14px; margin-top: 10px;">
                <div style="width: 44px; height: 44px; border-radius: 10px; background: #e6f0ff; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; color: #2563eb;">
                  Q
                </div>
                <div style="flex: 1;">
                  <div style="font-weight: 700; color: #111827;">{{ quiz.title }}</div>
                  <div style="color: #6b7280; font-size: 0.95rem;">{{ quiz.subject.name if quiz.subject else 'Unspecified' }}  {{ quiz.questions|length }} questions</div>
                </div>
                <div style="display: flex; gap: 8px;">
                  <a href="{{ url_for('main.teacher_edit_quiz', quiz_id=quiz.id) }}" class="btn blue">Edit</a>
                  <button class="btn green quiz-delete-btn" data-quiz-id="{{ quiz.id }}">Delete</button>
                </div>
              </div>
            {% endfor %}
          {% else %}
            <div style="padding:20px; color:#6b7280;">No quizzes found for your account yet. Click <a href="{{ url_for('main.teacher_create_quiz') }}">Create Quiz</a> to add one.</div>
          {% endif %}
        </div>
      </div>
    </div>
  </body>
  <script>
    (function(){
      const input = document.getElementById('quiz-search');
      if(!input) return;
      const container = document.querySelector('.available-quizzes');
      input.addEventListener('input', function(e){
        const q = (e.target.value || '').trim().toLowerCase();
        const items = container.querySelectorAll('.quiz-item');
        items.forEach(it => {
          const title = (it.dataset.title || '').toLowerCase();
          const subject = (it.dataset.subject || '').toLowerCase();
          if(!q || title.indexOf(q) !== -1 || subject.indexOf(q) !== -1){
            it.style.display = '';
          } else {
            it.style.display = 'none';
          }
        });
      });
    })();
    // Delete modal and request handling
    (function(){
      // create a simple modal element appended to body
      function createModal(){
        const html = `
          <div id="delete-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.45); align-items:center; justify-content:center; z-index:9999;">
            <div style="background:#fff; border-radius:8px; max-width:420px; width:90%; padding:18px; box-shadow:0 8px 24px rgba(0,0,0,0.2);">
              <h3 style="margin-bottom:8px;">Delete quiz?</h3>
              <p style="color:#6b7280; margin-bottom:16px;">This action cannot be undone. Are you sure you want to delete this quiz?</p>
              <div style="display:flex; gap:8px; justify-content:flex-end;">
                <button id="delete-cancel" style="padding:8px 12px; border-radius:6px; border:1px solid #e6e6e6; background:#fff;">Cancel</button>
                <button id="delete-confirm" style="padding:8px 12px; border-radius:6px; background:#dc2626; color:#fff; border:none;">Delete</button>
              </div>
            </div>
          </div>
        `;
        const wrap = document.createElement('div');
        wrap.innerHTML = html;
        document.body.appendChild(wrap.firstElementChild);
      }

      function showModal(){
        const m = document.getElementById('delete-modal');
        if(!m) return;
        m.style.display = 'flex';
      }
      function hideModal(){
        const m = document.getElementById('delete-modal');
        if(!m) return;
        m.style.display = 'none';
      }

      createModal();

      let pendingQuizId = null;

      document.addEventListener('click', function(e){
        const btn = e.target.closest && e.target.closest('.quiz-delete-btn');
        if(!btn) return;
        e.preventDefault();
        pendingQuizId = btn.dataset.quizId;
        showModal();
      });

      document.getElementById('delete-cancel').addEventListener('click', function(){
        pendingQuizId = null;
        hideModal();
      });

      document.getElementById('delete-confirm').addEventListener('click', function(){
        if(!pendingQuizId) return;
        // POST to delete endpoint
        fetch(`{{ url_for('main.teacher_delete_quiz', quiz_id=0) }}`.replace('/0', '/' + pendingQuizId), {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-Requested-With': 'XMLHttpRequest'
          },
          body: JSON.stringify({})
        }).then(r => r.json().then(data => ({status: r.status, body: data}))).then(res => {
          if(res.status === 200){
            // remove DOM node for quiz
            const el = document.querySelector(`.quiz-item[data-title][data-subject][data-quiz-id='${pendingQuizId}']`) || document.querySelector(`.quiz-item .quiz-delete-btn[data-quiz-id='${pendingQuizId}']`)?.closest('.quiz-item');
            // fallback: find by scanning items for matching dataset-quiz-id
            if(!el){
              const items = document.querySelectorAll('.quiz-item');
              items.forEach(it => {
                const b = it.querySelector('.quiz-delete-btn');
                if(b && b.dataset.quizId === String(pendingQuizId)){
                  it.remove();
                }
              });
            } else {
              el.remove();
            }
          } else {
            alert((res.body && res.body.error) || 'Failed to delete quiz');
          }
        }).catch(err => {
          console.error(err);
          alert('Network error while deleting quiz');
        }).finally(() => {
          pendingQuizId = null;
          hideModal();
        });
      });
    })();
  </script>
</html>
