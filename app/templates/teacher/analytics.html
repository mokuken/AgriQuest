<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Analytics</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/animations.css') }}" />
  </head>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: #f8f9e9;
      min-height: 100vh;
      display: flex;
    }

    .left {
      width: 20%;
      background: white;
      padding: 20px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      min-height: 100vh;
      border-right: 1px solid #e0e0e0;
    }

    .right {
      height: 100vh;
      width: 80%;
      overflow-y: scroll;
      padding-bottom: 20px;
      overflow-x: hidden;
    }

    .header {
      width: 100%;
      background-color: #fff;
      border-bottom: 1px solid #e0e0e0;
      margin-bottom: 20px;
      padding: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header-title {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .section {
      display: flex;
      gap: 20px;
      padding: 0 20px;
      margin-top: 20px;
        transform: translateX(100%);           /* start off to the right */
  animation: slideIn 600ms ease-out forwards;
    }

    .section-left,
    .section-right {
      border-radius: 12px;
    }

    .section-left {
      width: 70%;
    }

    .section-right {
      width: 30%;
    }
  </style>
  <body>
    <div class="left">

      {% include 'partials/teacher_sidebar.html' %}

    </div>
    <div class="right">
      <div class="header">
        <div class="header-title">
          <span style="font-size: 1.5rem; font-weight: 700; color: #2d3a2d"
            >Analytics</span
          >
          <span style="font-size: 1rem; color: grey"
            >Here's what's happening with your analytics
            today.</span
          >
        </div>
        <div class="header-actions">
        </div>
      </div>
      <style>
        /* Scoped styles for analytics section */
        .analytics-section { padding: 0.75rem 0 1.5rem; }
        .analytics-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; align-items: start; }
        .card { background: #fff; border-radius: 8px; box-shadow: 0 1px 4px rgba(16,24,40,0.06); border: 1px solid #eef2f7; overflow: hidden; }
        .card-header { padding: 1rem 1.2rem; border-bottom: 1px solid #f3f4f6; }
        .card-header h3 { margin: 0; font-size: 1rem; color: #0f172a; }
        .card-body { padding: 1rem; }

        /* SVG chart styles */
        .chart-svg { width: 100%; height: 220px; display: block; }
        .chart-svg .grid-lines line { stroke: #eef2f3; stroke-width: 1; }
        .chart-svg .labels text { font-family: system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; }

        /* Bar chart styles */
        .bars { display: flex; flex-direction: column; gap: 0.6rem; }
        .bar-row { display: grid; grid-template-columns: 1fr 3fr auto; align-items: center; gap: 0.6rem; }
        .bar-label { color: #374151; font-size: 0.95rem; }
        .bar-wrap { background: #f3f4f6; height: 14px; border-radius: 8px; position: relative; overflow: hidden; }
        .bar { height: 100%; background: #2563eb; width: var(--value, 50%); transition: width 400ms ease; border-radius: 8px; }
        .bar-value { color: #374151; font-weight: 600; font-size: 0.85rem; }

        /* Responsiveness */
        @media (max-width: 900px) {
          .analytics-grid { grid-template-columns: 1fr; }
          .chart-svg { height: 200px; }
        }
      </style>
      <div class="section" style="width: 100%;">
      <!-- Analytics cards: two responsive cards with pure HTML/CSS charts placeholders -->
      <section class="analytics-section" aria-label="Analytics overview">
        <div class="analytics-grid">
          <article class="card chart-card line-card" aria-labelledby="student-trend-title">
            <header class="card-header">
              <h3 id="student-trend-title">Student Performance Trend</h3>
            </header>
            <div class="card-body">
              <!-- Simple SVG line chart created with HTML/CSS only (no JS) -->
              <svg viewBox="0 0 600 220" preserveAspectRatio="xMidYMid meet" class="chart-svg" role="img" aria-label="Student performance trend line chart">
                <rect x="0" y="0" width="100%" height="100%" fill="none" />
                <!-- horizontal grid lines -->
                <g class="grid-lines">
                  <line x1="40" y1="20" x2="560" y2="20" />
                  <line x1="40" y1="60" x2="560" y2="60" />
                  <line x1="40" y1="100" x2="560" y2="100" />
                  <line x1="40" y1="140" x2="560" y2="140" />
                  <line x1="40" y1="180" x2="560" y2="180" />
                </g>
                <!-- axes labels -->
                <g class="labels" fill="#6b7280" font-size="12">
                  <text x="10" y="24">100</text>
                  <text x="10" y="64">75</text>
                  <text x="10" y="104">50</text>
                  <text x="10" y="144">25</text>
                  <text x="10" y="184">0</text>
                </g>
                <!-- dynamic data polyline -->
                {% if trend_points %}
                <polyline points="{{ trend_points }}" fill="none" stroke="#10b981" stroke-width="3" stroke-linejoin="round" stroke-linecap="round" />
                {% endif %}
                <!-- data points -->
                <g class="points" fill="#10b981" stroke="#fff" stroke-width="2">
                  {% if trend_circles %}
                    {% for c in trend_circles %}
                      <circle cx="{{ c.x }}" cy="{{ c.y }}" r="5" />
                    {% endfor %}
                  {% endif %}
                </g>
                <!-- x-axis labels -->
                <g class="xlabels" fill="#374151" font-size="12">
                  {% if trend_labels %}
                    {% for label in trend_labels %}
                      {% set x = 60 + (loop.index0 * 100) %}
                      <text x="{{ x }}" y="205">{{ label }}</text>
                    {% endfor %}
                  {% endif %}
                </g>
              </svg>
            </div>
          </article>

          <article class="card chart-card bar-card" aria-labelledby="subject-performance-title">
            <header class="card-header">
              <h3 id="subject-performance-title">Subject Performance</h3>
            </header>
            <div class="card-body">
              <!-- simple CSS-only bar chart using inline bars -->
              <div class="bars" role="img" aria-label="Average score by subject">
                {% if trend_subjects and trend_subjects|length > 0 %}
                  {% for s in trend_subjects %}
                    {% set pct = (s.avg_percent if s.avg_percent is not none else 0) %}
                    <div class="bar-row">
                      <div class="bar-label">{{ s.name }}</div>
                      <div class="bar-wrap"><div class="bar" data-pct="{{ pct }}"></div></div>
                      <div class="bar-value">{% if s.avg_percent is not none %}{{ s.avg_percent }}%{% else %}n/a{% endif %}</div>
                    </div>
                  {% endfor %}
                {% else %}
                  <!-- fallback static bars if no subject data available -->
                  <div class="bar-row">
                    <div class="bar-label">Agriculture</div>
                      <div class="bar-wrap"><div class="bar" data-pct="80"></div></div>
                    <div class="bar-value">80%</div>
                  </div>
                  <div class="bar-row">
                    <div class="bar-label">Biology</div>
                      <div class="bar-wrap"><div class="bar" data-pct="74"></div></div>
                    <div class="bar-value">74%</div>
                  </div>
                  <div class="bar-row">
                    <div class="bar-label">Chemistry</div>
                      <div class="bar-wrap"><div class="bar" data-pct="66"></div></div>
                    <div class="bar-value">66%</div>
                  </div>
                  <div class="bar-row">
                    <div class="bar-label">Physics</div>
                      <div class="bar-wrap"><div class="bar" data-pct="70"></div></div>
                    <div class="bar-value">70%</div>
                  </div>
                {% endif %}
              </div>
            </div>
          </article>

          <article class="card chart-card bar-card" aria-labelledby="quiz-performance-title">
            <header class="card-header">
              <h3 id="quiz-performance-title">Quiz Performance</h3>
            </header>
            <div class="card-body">
              <!-- simple CSS-only bar chart using inline bars -->
              <div class="bars" role="img" aria-label="Average score by quiz">
                {% if trend_quizzes and trend_quizzes|length > 0 %}
                  {% for q in trend_quizzes %}
                    {% set pct = (q.avg_percent if q.avg_percent is not none else 0) %}
                    <div class="bar-row">
                      <div class="bar-label">{{ q.title }}</div>
                      <div class="bar-wrap"><div class="bar" data-pct="{{ pct }}"></div></div>
                      <div class="bar-value">{% if q.avg_percent is not none %}{{ q.avg_percent }}%{% else %}n/a{% endif %}</div>
                    </div>
                  {% endfor %}
                {% else %}
                  <div class="bar-row">
                    <div class="bar-label">No quizzes yet</div>
                    <div class="bar-wrap"><div class="bar" data-pct="0"></div></div>
                    <div class="bar-value">n/a</div>
                  </div>
                {% endif %}
              </div>
            </div>
          </article>
        </div>
      </section>
      </div>
    </div>
  </body>
  <script>
    // set bar widths from data-pct to avoid inline CSS with Jinja inside style attributes
    (function(){
      try{
        document.querySelectorAll('.bar[data-pct]').forEach(function(el){
          var v = el.getAttribute('data-pct') || '0';
          var n = parseFloat(v);
          if(isNaN(n)) n = 0;
          if(n < 0) n = 0; if(n > 100) n = 100;
          el.style.width = n + '%';
        });
      }catch(e){ /* fail silently */ }
    })();
  </script>
</html>
